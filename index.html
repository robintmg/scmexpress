<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>REQUEST FOR PAYMENT FORM</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background-color: #f4f4f9;
            padding: 20px;
            margin: 0;
            color: #333;
        }

        /* --- INPUT FORM STYLES --- */
        .no-print {
            max-width: 800px;
            margin: 0 auto;
            background: #fff;
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.08);
            border: 1px solid #e0e0e0;
        }

        .form-section-title {
            font-size: 14px;
            text-transform: uppercase;
            color: #666;
            letter-spacing: 1px;
            border-bottom: 1px solid #eee;
            padding-bottom: 5px;
            margin-bottom: 20px;
            margin-top: 10px;
            font-weight: bold;
        }

        .form-row {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .input-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
            flex: 1; 
        }
        
        .grow-2 { flex: 2; } 
        .grow-0-5 { flex: 0.5; }

        input[type="text"], input[type="number"], input[type="date"], textarea { 
            padding: 12px; 
            border: 1px solid #ccc; 
            border-radius: 6px; 
            font-size: 14px;
            transition: border-color 0.3s;
            width: 100%;
            box-sizing: border-box; 
        }

        input:focus, textarea:focus { border-color: #007bff; outline: none; }

        label { font-weight: bold; font-size: 13px; color: #444; }

        .radio-group {
            display: flex; gap: 15px; flex-wrap: wrap; 
            background: #f1f3f5; padding: 15px;
            border-radius: 8px; width: 100%; box-sizing: border-box;
        }
        .radio-group label { cursor: pointer; display: flex; align-items: center; gap: 6px; font-weight: 600; }

        /* Buttons */
        .btn-container {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }

        button { padding: 15px 25px; cursor: pointer; border-radius: 6px; border: none; font-weight: bold; font-size: 15px; transition: transform 0.1s, background 0.2s; flex: 1;}
        button:active { transform: translateY(1px); }
        
        #printNowBtn { 
            background-color: #28a745; color: white; 
            box-shadow: 0 4px 6px rgba(40, 167, 69, 0.2);
            flex: 2; /* Make print button larger */
        }
        #printNowBtn:hover { background-color: #218838; }

        #clearAllBtn {
            background-color: #dc3545; color: white;
            box-shadow: 0 4px 6px rgba(220, 53, 69, 0.2);
            flex: 1;
        }
        #clearAllBtn:hover { background-color: #c82333; }

        /* Floating Actions */
        .action-buttons { 
            position: fixed; bottom: 30px; right: 30px; z-index: 100; 
            display: flex; gap: 10px;
        }
        
        #backBtn { background-color: #6c757d; color: white; box-shadow: 0 2px 5px rgba(0,0,0,0.2); width: auto; padding: 12px 20px;}
        #backBtn:hover { background-color: #5a6268; }

        #createNewBtn { background-color: #007bff; color: white; box-shadow: 0 2px 5px rgba(0,0,0,0.2); width: auto; padding: 12px 20px;}
        #createNewBtn:hover { background-color: #0069d9; }

        /* --- PRINT PREVIEW CONTAINER --- */
        #app-container {
            width: 850px; 
            min-height: 1050px; 
            margin: 20px auto;
            background-color: white;
            padding: 30px 40px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            box-sizing: border-box;
            border: 1px solid #ccc;
            display: flex; 
            flex-direction: column;
            gap: 15px; 
        }

        .hidden-on-screen { display: none !important; }

        /* Internal Print Classes */
        .header-section { display: flex; align-items: center; justify-content: center; margin-bottom: 5px; position: relative; min-height: 80px; }
        .logo-placeholder { width: 120px; position: absolute; left: 0; top: 50%; transform: translateY(-50%); }
        .logo-placeholder img { max-width: 100%; height: auto; object-fit: contain; }
        .form-title { font-size: 16pt; font-weight: bold; margin: 0; text-align: center; width: 100%; }
        
        .check-options { display: flex; justify-content: flex-start; gap: 30px; margin-bottom: 10px; align-items: center; font-size: 9pt; padding-left: 0; margin-left: 60px; }
        .check-item { display: flex; align-items: center; gap: 8px; }
        .checkbox-box { width: 30px; height: 20px; border: 1px solid black; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 1.4em; line-height: 1; }
        
        .top-details-group { display: flex; justify-content: space-between; align-items: flex-end; padding-bottom: 5px; font-size: 9pt; gap: 20px; }
        .top-details-group > div { display: flex; align-items: flex-end; gap: 10px; }
        .top-details-group > div:nth-child(1) { flex: 25; min-width: 0; }
        .top-details-group > div:nth-child(2) { flex: 0 0 125px; }
        .top-details-group > div:nth-child(3) { flex: 0 0 125px; justify-content: flex-end; }
        .detail-label { white-space: nowrap; padding-bottom: 2px; line-height: 1.3; }
        .detail-value { width: 100%; border-bottom: 1px solid black; text-align: left; padding-bottom: 2px; text-transform: uppercase; white-space: normal; line-height: 1.3; padding-left: 10px; }
        
        .table-section { border: 1px solid black; display: flex; flex-direction: column; border-inline: none; font-size: 9pt; }
        .table-header { display: flex; border-bottom: 1px solid black; text-align: center; }
        .header-particulars { flex: 3; text-align: center; border-right: 1px solid black; padding: 8px 10px; }
        .header-amount { flex: 1; padding: 8px 10px; }
        .table-body { flex-grow: 1; display: flex; flex-direction: column; }
        .table-row { display: flex; flex-grow: 1; min-height: 100px; }
        .cell-particulars { flex: 3; padding: 10px; border-right: 1px solid black; white-space: pre-wrap; text-align: left; font-size: 9pt; }
        .cell-amount { flex: 1; padding: 10px; text-align: center; font-size: 9pt; }
        .table-footer { display: flex; border-top: none; font-weight: bold; background-color: #fff; }
        .footer-label-box { flex: 3; border-right: 1px solid black; padding: 10px; display: flex; justify-content: flex-end; align-items: center; }
        .footer-amount-box { flex: 1; padding: 10px; display: flex; justify-content: center; align-items: center; }
        .total-label { font-size: 9pt; margin-right: 5px; }
        .total-value { font-size: 9pt; }

        /* --- UPDATED SIGNATURES CSS --- */
        .signatures-section {
            display: flex;
            justify-content: space-between;
            margin-top: 5px;
            gap: 20px;
            flex-shrink: 0;
            align-items: stretch;
        }
        .signature-block {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            font-size: 9pt;
        }
        .signature-label {
            margin-bottom: 25px; 
            font-size: 1em;
            font-weight: normal;
        }
        .signature-wrapper {
            width: 80%;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            align-items: center;
            margin-bottom: 2px;
            flex-grow: 1;
        }
        .signature-name-line {
            width: 100%;
            border-bottom: 1px solid black;
            min-height: 1.5em;
            display: flex;
            align-items: flex-end;
            justify-content: center;
            padding-bottom: 2px;
            font-weight: bold;
            text-transform: uppercase;
            white-space: normal;
            line-height: 1.2;
        }
        .signature-label-below {
            flex-shrink: 0;
        }
        /* --------------------------- */

        .footer-notes { font-size: 7pt; flex-shrink: 0; }
        .finance-section { display: flex; justify-content: space-between; border-top: 4px double black; padding-top: 5px; gap: 30px; flex-shrink: 0; font-size: 9pt; }
        .finance-block { display: flex; flex-direction: column; gap: 3px; flex: 1; }
        .finance-title { font-weight: bold; margin-bottom: 5px; }
        .finance-item { display: flex; align-items: flex-end; gap: 10px; }
        .finance-label { white-space: nowrap; font-size: 0.9em; min-width: 60px; }
        .finance-input-line { flex-grow: 1; border-bottom: 1px solid black; min-width: 150px; min-height: 1.5em; }

        /* --- PRINT MEDIA QUERY --- */
        @media print {
            @page {
                margin: 0;
                size: auto; /* Uses printer default paper size */
            }

            html, body {
                width: 100%;
                height: 100%; /* Forces body to match paper height */
                margin: 0 !important;
                padding: 0 !important;
                overflow: hidden !important; /* key fix: hides anything spilling to page 2 */
                background-color: white;
            }

            .no-print, .action-buttons {
                display: none !important;
            }

            #app-container {
                width: 100% !important;
                height: 100% !important; /* Fill exactly one page */
                max-height: 100% !important; /* Prevent growing beyond one page */
                margin: 0 !important;
                
                /* Reduced top/bottom padding slightly to ensure fit (was 30px) */
                padding: 20px 40px !important; 
                
                box-shadow: none !important;
                border: none !important;
                display: flex !important;
                
                /* Tell printer not to create a break after this element */
                page-break-after: avoid !important;
                break-after: avoid !important;
            }
        }
    </style>
</head>
<body>

    <div id="input-section" class="no-print">
        <h1 style="text-align: center; margin-bottom: 10px; color: #333;">üìù Request for Payment</h1>
        <p style="text-align: center; color: #666; margin-bottom: 30px; font-size: 14px;">Fill out the details below to generate the print form.</p>
        
        <div class="form-section-title">1. Payment Type</div>
        <div class="form-row">
            <div class="radio-group">
                <label><input type="radio" name="type-opt" value="cash"> Cash Advance</label>
                <label><input type="radio" name="type-opt" value="reimbursement"> Reimbursement</label>
                <label><input type="radio" name="type-opt" value="pcf"> PCF(Store)</label>
                <label><input type="radio" name="type-opt" value="external" checked> External</label>
            </div>
        </div>

        <div class="form-section-title">2. General Information</div>
        <div class="form-row">
            <div class="input-group grow-2">
                <label>Payee Name:</label>
                <input type="text" id="payee" placeholder="Enter full name" required>
            </div>
            <div class="input-group">
                <label>Department:</label>
                <input type="text" id="department" placeholder="Dept Code" value="SCM" required>
            </div>
            <div class="input-group">
                <label>Date:</label>
                <input type="date" id="date-input" required>
            </div>
        </div>

        <div class="form-row">
            <div class="input-group">
                <label>Requested By:</label>
                <input type="text" id="request-by" placeholder="Requestor Name">
            </div>
            <div class="input-group">
                <label>Approved By:</label>
                <input type="text" id="approved-by" placeholder="Approver Name">
            </div>
        </div>

        <div class="form-section-title">3. Financial Details</div>
        <div class="form-row">
            <div class="input-group">
                <label>Particulars:</label>
                <textarea id="particulars" rows="3" placeholder="Main description of expense..."></textarea>
            </div>
        </div>
        <div class="form-row">
            <div class="input-group">
                <label>Additional Details:</label>
                <textarea id="details" rows="3" placeholder="Extra notes or breakdown..."></textarea>
            </div>
        </div>

        <div class="form-row" style="align-items: flex-end; background: #f9f9f9; padding: 15px; border-radius: 8px; border: 1px dashed #ccc;">
            <div class="input-group grow-0-5">
                <label>Currency:</label>
                <div class="radio-group" style="padding: 10px; margin: 0;">
                    <label><input type="radio" name="currency-opt" value="‚Ç±" checked> (‚Ç±) Peso</label>
                    <label><input type="radio" name="currency-opt" value="$"> ($) USD</label>
                </div>
            </div>
            <div class="input-group grow-2">
                <label>Total Amount:</label>
                <input type="number" id="amount" placeholder="0.00" style="font-size: 18px; font-weight: bold;">
            </div>
        </div>
        
        <div class="btn-container">
            <button id="clearAllBtn">‚ùå Clear All</button>
            <button id="printNowBtn">üñ®Ô∏è Print Form</button>
        </div>
    </div>

    <div id="app-container" class="hidden-on-screen">
        <div class="header-section">
            <div class="logo-placeholder">
                <img src="logo.png" alt="Logo">
            </div>
            <h1 class="form-title">REQUEST FOR PAYMENT</h1>
        </div>

        <div class="check-options">
            <div class="check-item"><div id="check-cash" class="checkbox-box"></div><span>CASH ADVANCE</span></div>
            <div class="check-item"><div id="check-reimburse" class="checkbox-box"></div><span>REIMBURSEMENT</span></div>
            <div class="check-item"><div id="check-pcf" class="checkbox-box"></div><span>PCF (STORE)</span></div>
            <div class="check-item"><div id="check-external" class="checkbox-box"></div><span>EXTERNAL</span></div>
        </div>

        <div class="top-details-group">
            <div><span class="detail-label">PAYEE</span><span id="display-payee" class="detail-value"></span></div>
            <div style="flex-grow: 0.5;"><span class="detail-label">DEP</span><span id="display-department" class="detail-value"></span></div>
            <div style="flex-grow: 0.5;"><span class="detail-label">DATE</span><span id="display-date" class="detail-value"></span></div>
        </div>
        
        <div class="table-section">
            <div class="table-header">
                <div class="header-particulars">PARTICULARS</div>
                <div class="header-amount">AMOUNT</div>
            </div>
            <div class="table-body">
                <div class="table-row">
                    <div id="display-particulars" class="cell-particulars"></div>
                    <div class="cell-amount"><span id="display-amount"></span></div>
                </div>
            </div>
            <div class="table-footer">
                <div class="footer-label-box"><span class="total-label">TOTAL</span></div>
                <div class="footer-amount-box"><span id="display-total-amount" class="total-value"></span></div>
            </div>
        </div>

        <div class="signatures-section">
            <div class="signature-block">
                <span class="signature-label">REQUESTED BY</span>
                <div class="signature-wrapper">
                    <span id="display-request-by" class="signature-name-line"></span>
                </div>
                <span class="signature-label-below">Signature over Printed Name</span>
            </div>

            <div class="signature-block">
                <span class="signature-label">APPROVED BY</span>
                <div class="signature-wrapper">
                    <span id="display-approved-by" class="signature-name-line"></span>
                </div>
                <span class="signature-label-below">Director Head</span>
            </div>

            <div class="signature-block">
                <span class="signature-label">RECEIVED BY</span>
                <div class="signature-wrapper"><span class="signature-name-line"></span></div>
                <span class="signature-label-below">Finance</span>
            </div>
        </div>

        <div class="footer-notes">
            <span>*This form must be accomplished before forwarding to Finance for processing</span><br>
            <span>Attach all the necessary supporting documents</span>
        </div>

        <div class="finance-section">
            <div class="finance-block">
                <div class="finance-title">FINANCE</div>
                <div class="finance-item"><span class="finance-label">AR</span><div class="finance-input-line"></div></div>
                <div class="finance-item"><span class="finance-label">BUDGET</span><div class="finance-input-line"></div></div>
            </div>
            <div class="finance-block">
                <div style="height: 1.5em;"></div> 
                <div class="finance-item"><span class="finance-label">CHARGED TO</span><div class="finance-input-line"></div></div>
                <div class="finance-item"><span class="finance-label">CONTROLLER</span><div class="finance-input-line"></div></div>
            </div>
        </div>
    </div>

    <div class="action-buttons hidden-on-screen" id="action-buttons">
        <button id="backBtn">‚Üê Edit Current</button>
        <button id="createNewBtn">+ Create New RFP</button>
    </div>

    <script>
        // Elements
        const appContainer = document.getElementById('app-container');
        const inputSection = document.getElementById('input-section');
        const actionButtons = document.getElementById('action-buttons');

        const payeeInput = document.getElementById('payee');
        const deptInput = document.getElementById('department');
        const requestByInput = document.getElementById('request-by');
        const approvedByInput = document.getElementById('approved-by');
        const dateInput = document.getElementById('date-input');
        const particularsInput = document.getElementById('particulars');
        const detailsInput = document.getElementById('details');
        const amountInput = document.getElementById('amount');
        const typeRadios = document.getElementsByName('type-opt'); 
        const currencyRadios = document.getElementsByName('currency-opt'); 

        // Display Targets
        const displayPayee = document.getElementById('display-payee');
        const displayDepartment = document.getElementById('display-department');
        const displayDate = document.getElementById('display-date');
        const displayRequestBy = document.getElementById('display-request-by');
        const displayApprovedBy = document.getElementById('display-approved-by');
        const displayParticulars = document.getElementById('display-particulars');
        const displayAmount = document.getElementById('display-amount');
        const displayTotalAmount = document.getElementById('display-total-amount');
        
        const checkCash = document.getElementById('check-cash');
        const checkReimburse = document.getElementById('check-reimburse');
        const checkPcf = document.getElementById('check-pcf');
        const checkExternal = document.getElementById('check-external');

        // --- INITIALIZATION ---
        dateInput.valueAsDate = new Date();

        // --- AUTO-SAVE (Local Storage) ---
        const savedRequester = localStorage.getItem('rfp_requester');
        if (savedRequester) requestByInput.value = savedRequester;
        
        requestByInput.addEventListener('input', () => {
            localStorage.setItem('rfp_requester', requestByInput.value);
        });

        const savedApprover = localStorage.getItem('rfp_approver');
        if (savedApprover) approvedByInput.value = savedApprover;
        
        approvedByInput.addEventListener('input', () => {
            localStorage.setItem('rfp_approver', approvedByInput.value);
        });

        // --- PRINT LOGIC ---
        document.getElementById('printNowBtn').addEventListener('click', () => {
            // Validation
            let selectedType = null;
            for(const radio of typeRadios) { if(radio.checked) { selectedType = radio.value; break; } }
            
            if(!payeeInput.value || !amountInput.value || !particularsInput.value) { 
                alert("Please fill in Payee, Particulars, and Amount."); 
                return; 
            }

            // --- MAPPING DATA ---
            checkCash.textContent = ''; checkReimburse.textContent = ''; checkPcf.textContent = ''; checkExternal.textContent = '';
            if(selectedType === 'cash') checkCash.textContent = '‚úì';
            if(selectedType === 'reimbursement') checkReimburse.textContent = '‚úì';
            if(selectedType === 'pcf') checkPcf.textContent = '‚úì';
            if(selectedType === 'external') checkExternal.textContent = '‚úì';

            displayPayee.textContent = payeeInput.value.toUpperCase();
            displayDepartment.textContent = deptInput.value.toUpperCase();
            
            const rawDate = dateInput.value; 
            if(rawDate) {
                const [year, month, day] = rawDate.split('-');
                displayDate.textContent = `${month}/${day}/${year}`;
            } else {
                displayDate.textContent = '';
            }

            displayRequestBy.textContent = requestByInput.value.toUpperCase();
            displayApprovedBy.textContent = approvedByInput.value.toUpperCase();

            let combinedParticulars = particularsInput.value;
            if (detailsInput.value) {
                combinedParticulars += '\n\n' + detailsInput.value; 
            }
            displayParticulars.textContent = combinedParticulars;
            
            const rawVal = parseFloat(amountInput.value);
            let currencySymbol = '‚Ç±'; 
            for (const radio of currencyRadios) { if (radio.checked) { currencySymbol = radio.value; break; } }

            const formattedAmount = rawVal.toLocaleString('en-US', {
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            });

            displayAmount.textContent = `${formattedAmount}`;
            displayTotalAmount.textContent = `${currencySymbol} ${formattedAmount}`;

            // --- IMMEDIATE PRINT (SKIP REVIEW) ---
            inputSection.style.display = 'none';
            appContainer.classList.remove('hidden-on-screen');
            actionButtons.classList.remove('hidden-on-screen');

            // Small delay just to ensure DOM is updated, but effectively instant for user
            setTimeout(() => {
                window.print();
            }, 200);
        });

        // --- CLEAR ALL BUTTON ---
        document.getElementById('clearAllBtn').addEventListener('click', () => {
            if(confirm("Are you sure you want to clear all fields?")) {
                payeeInput.value = '';
                deptInput.value = 'SCM'; // Reset to default if needed, or ''
                particularsInput.value = '';
                detailsInput.value = '';
                amountInput.value = '';
                // Optional: Clear names or keep them? Usually "Clear All" means everything:
                requestByInput.value = ''; 
                approvedByInput.value = '';
                
                dateInput.valueAsDate = new Date(); // Reset to today
                
                // Reset Radio to Default (External & Peso)
                document.querySelector('input[name="type-opt"][value="external"]').checked = true;
                document.querySelector('input[name="currency-opt"][value="‚Ç±"]').checked = true;
            }
        });

        // --- BACK BUTTON ---
        document.getElementById('backBtn').addEventListener('click', () => {
            inputSection.style.display = 'block';
            appContainer.classList.add('hidden-on-screen');
            actionButtons.classList.add('hidden-on-screen');
        });

        // --- CREATE NEW RFP BUTTON ---
        document.getElementById('createNewBtn').addEventListener('click', () => {
            payeeInput.value = '';
            particularsInput.value = '';
            detailsInput.value = '';
            amountInput.value = '';
            dateInput.valueAsDate = new Date();
            inputSection.style.display = 'block';
            appContainer.classList.add('hidden-on-screen');
            actionButtons.classList.add('hidden-on-screen');
            payeeInput.focus();
        });
    </script>
</body>
</html>